var e=function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function n(){const e=[];for(let t=0;t<4;t++)e.push(Math.random().toString(36).slice(2));return e.join("")}r.r(t),r.d(t,"intentInterface",(function(){return s})),r.d(t,"intentErrors",(function(){return i}));var s={basic_info:{risk:"low",title:"View personal info",personalData:!0,unsafe:!1,implicitFlow:!1,params:{},returns:["info"]},public_key:{risk:"low",title:"View public key",personalData:!1,unsafe:!1,implicitFlow:!1,params:{token:{required:!1}},returns:["pubkey","token","token_signature"]},sign_message:{risk:"medium",title:"Sign text message",personalData:!1,unsafe:!1,implicitFlow:!0,params:{message:{required:!0},pubkey:{required:!1}},returns:["pubkey","message","original_message","message_signature"]},tx:{risk:"high",title:"Sign transaction",personalData:!1,unsafe:!0,implicitFlow:!0,params:{xdr:{required:!0},pubkey:{required:!1},network:{required:!1},horizon:{required:!1},callback:{required:!1},submit:{required:!1,type:Boolean}},returns:["xdr","signed_envelope_xdr","pubkey","tx_signature","network","submit"]},pay:{risk:"high",title:"Make payment",personalData:!1,unsafe:!1,implicitFlow:!0,params:{amount:{required:!0},destination:{required:!0},asset_code:{required:!1},asset_issuer:{required:!1},memo:{required:!1},memo_type:{required:!1},pubkey:{required:!1},network:{required:!1},horizon:{required:!1},submit:{required:!1,type:Boolean}},returns:["amount","destination","asset_code","asset_issuer","memo","memo_type","signed_envelope_xdr","pubkey","tx_signature","network","horizon"]},trust:{risk:"low",title:"Establish trustline",personalData:!1,unsafe:!1,implicitFlow:!0,params:{asset_code:{required:!0},asset_issuer:{required:!0},limit:{required:!1},pubkey:{required:!1},network:{required:!1},horizon:{required:!1},submit:{required:!1,type:Boolean}},returns:["asset_code","asset_issuer","limit","signed_envelope_xdr","pubkey","tx_signature","network","horizon"]},implicit_flow:{risk:"high",title:"Grant session permissions",personalData:!1,unsafe:!0,implicitFlow:!1,params:{intents:{required:!0}},returns:["granted","intents","session","pubkey","valid_until"]},create_keypair:{risk:"low",title:"Create new key pair",personalData:!1,unsafe:!1,implicitFlow:!0,params:{name:{required:!1}},returns:["pubkey"]},exchange:{risk:"high",title:"Purchase tokens",unsafe:!0,implicitFlow:!1,params:{sell_asset_code:{required:!1},sell_asset_issuer:{required:!1},buy_asset_code:{required:!1},buy_asset_issuer:{required:!1},amount:{required:!0},max_price:{required:!0},pubkey:{required:!1},network:{required:!1},horizon:{required:!1},submit:{required:!1,type:Boolean}},returns:["amount","max_price","sell_asset_code","sell_asset_issuer","buy_asset_code","buy_asset_issuer","tx_signature","network","horizon"]}};var i={unhandledError:{message:"Unhandled error occurred. If this error persists, please contact our support team.",code:-1},externalError:{message:"External error occurred.",code:-2},invalidIntentRequest:{message:"Intent request is invalid.",code:-3},actionRejectedByUser:{message:"Action request was rejected by the user.",code:-4}};function o(e,t){if(null==e)return{};var r,n,s=function(e,t){if(null==e)return{};var r,n,s={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var a=class{constructor(e,t=!1){this.isLoaded=!1,this.windowHandler=e,this.ephemeral=!!t,this.isLoaded=!1,this.pendingRequests={},this.onLoaded=new Promise((e,t)=>this.onLoadedCallback=e),this.messageHandler=this.messageHandler.bind(this),window.addEventListener("message",this.messageHandler,!1)}markLoaded(){if(this.isLoaded=!0,this.onLoadedCallback){const e=this.onLoadedCallback;this.onLoadedCallback=null,e()}}messageHandler({data:e}){if(e.albedo){const{version:t}=e.albedo;return this.markLoaded()}if(e.albedoIntentResult){const t=e.albedoIntentResult,{__reqid:r}=t,n=o(t,["__reqid"]),s=this.pendingRequests[r];s&&(delete this.pendingRequests[r],s(n.error,n),this.ephemeral&&(window.removeEventListener("message",this.messageHandler,!1),this.windowHandler.close()))}}transportCloseHandler(){for(let e in this.pendingRequests)if(this.pendingRequests.hasOwnProperty(e)){const t=this.pendingRequests[e];delete this.pendingRequests[e],t(i.actionRejectedByUser)}}prepareRequestParams(e){return e}postMessage(e){const t=n();return new Promise((r,n)=>{this.onLoaded.then(()=>{this.pendingRequests[t]=(e,t)=>e?n(e):r(t),e=this.prepareRequestParams(Object.assign({__reqid:t},e)),this.windowHandler.postMessage(e,"*")})})}};let u=null;var l=class{constructor({session:e,pubkey:t,grants:r,valid_until:n}){this.key="",this.pubkey="",this.grants=[],this.validUntil=0,this.key=e,this.pubkey=t,this.grants=r.slice(),this.validUntil=n,Object.freeze(this),Object.freeze(this.grants)}get isExpired(){return this.validUntil-2e3<(new Date).getTime()}toJSON(){return{session:this.key,pubkey:this.pubkey,grants:this.grants.slice(),valid_until:this.validUntil}}};var d=new class{constructor(){this.saveToBrowserStorage=!1,this.implicitSessions={},this.saveToBrowserStorage=!0}addSession(e){const t=new l(e);this.saveToBrowserStorage?window.sessionStorage.setItem("albedo_session_"+t.pubkey,JSON.stringify(t)):this.implicitSessions[t.pubkey]=t}getImplicitSession(e,t){let r;if(this.saveToBrowserStorage){const e=window.sessionStorage.getItem("albedo_session_"+t);e&&(r=new l(JSON.parse(e)))}else r=this.implicitSessions[t];return r?r.isExpired?(delete this.implicitSessions[t],null):r.grants.includes(e)?r:null:null}};var c=new class{requestIntentConfirmation(e,t){const{intent:r}=e;if(!r)return Promise.reject(new Error('Parameter "intent" is required.'));const n=s[r];return n?this.prepareRequestParams(n,e).then(e=>this.sendRequest(e,t)):Promise.reject(new Error('Unknown intent: "'.concat(r,'".')))}sendRequest(e,t){let r;if(window.albedo&&window.albedo.extensionEnabled&&(u||(u=new a(window),u.prepareRequestParams=e=>({albedoExtensionRequest:e}),u.markLoaded()),r=u),e.pubkey){const n=d.getImplicitSession(e.intent,e.pubkey);n&&(e.session=n.key,r=r||function(e){if(!u){const t=document.createElement("iframe");Object.assign(t,{width:0,height:0,border:0,referrerpolicy:"origin",position:"absolute",style:"",src:"".concat(e,"/implicit")}),document.body.appendChild(t),u=new a(t.contentWindow)}return u}(t))}return r||(r=function(e){const t="".concat(e,"/confirm"),r=void 0!==window.screenLeft?window.screenLeft:window.screenX,n=void 0!==window.screenTop?window.screenTop:window.screenY,s=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-220+r,i=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-300+n,o=window.open(t,"auth.albedo.link","height=".concat(600,",width=").concat(440,",top=").concat(i,",left=").concat(s,",menubar=0,toolbar=0,location=0,status=0,personalbar=0,scrollbars=0,dependent=1"));return new a(o,!0)}(t)),r.postMessage(e).then(e=>("implicit_flow"===e.intent&&e.granted&&d.addSession(e),e))}prepareRequestParams(e,t){if("object"!=typeof t)return Promise.reject(new Error("Intent parameters expected."));const{intent:r,pubkey:n}=t,s={intent:r};if(n&&!/^G[0-9A-Z]{55}$/.test(n))return Promise.reject(new Error('Invalid "pubkey" parameter. Stellar account public key expected.'));for(const n in e.params){const i=e.params[n],o=t[n];if(o)s[n]=o;else if(i.required)return Promise.reject(new Error('Parameter "'.concat(n,'" is required for intent "').concat(r,'".')))}return Promise.resolve(s)}};if("object"==typeof window&&"function"!=typeof window.fetch)throw new Error("Browser FetchAPI is not available. For legacy browsers support use polyfills such as whatwg-fetch.");class p{constructor(){this.frontendUrl="https://albedo.link"}request(e,t){return c.requestIntentConfirmation(Object.assign(t||{},{intent:e}),this.frontendUrl)}implicitFlow(e){return this.request("implicit_flow",e)}basicInfo(){return this.request("basic_info")}publicKey(e){return e=Object.assign({},e,{token:e.token||this.generateRandomToken()}),this.request("public_key",e)}tx(e){return this.request("tx",e)}pay(e){return this.request("pay",e)}trust(e){return this.request("trust",e)}inflationVote(e){return this.request("inflation_vote",e)}signMessage(e){return e=Object.assign({},e,{message:m(e.message)}),this.request("sign_message",e)}createKeypair(e){return this.request("create_keypair",e)}generateRandomToken(){return n()}exchange(e){return this.request("exchange",e)}isImplicitSessionAllowed(e,t){return!!d.getImplicitSession(e,t)}}function m(e){switch(typeof e){case"string":return e;case"undefined":return""}return JSON.stringify(e)}p.intentInterface=s,p.intentErrors=i;t.default=new p}]);const t=e.intentInterface,r=e.intentErrors;export default e.default;export{t as intentInterface,r as intentErrors};
//# sourceMappingURL=albedo.intent.js.map